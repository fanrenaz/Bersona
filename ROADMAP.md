# Bersona 项目路线图

> 2025-10 更新：项目战略聚焦于“西方占星 (Western Astrology)” 单一体系，不再并行支持八字、紫微、人类图等多体系排盘。这样可以：
> 1. 将有限的工程与 Prompt 资源集中到一个高保真语义空间；
> 2. 避免多体系术语混淆与 Schema 过早膨胀；
> 3. 更快迭代从太阳星座 → 完整本命盘 → 语义生成的纵向能力梯度。

本路线图现分为三个阶段：基础版 (MVP)、高保真占星引擎以及以占星画像为核心的生态扩展。所有里程碑仅围绕“占星出生数据 → 结构化特征 → 画像生成”主线展开。

---

## 🗺️ 路线图总览

- **第一阶段: 占星基础版 (MVP)** - `进行中`
    - **核心目标：** 验证“仅凭生日（无具体时间地点）即可得到可用占星画像”这一冷启动价值；建立最小结构化+解析闭环。
- **第二阶段: 高保真占星引擎** - `进行中`
    - **核心目标：** 支持出生时间与地点，生成完整本命盘（行星 + 宫位 + 核心角度），并扩展结构化 Schema / Prompt 策略。
- **第三阶段: 占星画像生态** - `未来规划`
    - **核心目标：** 构建围绕“占星画像生成与应用”的工具、服务与轻量模型，形成开发者与应用生态。

---

## **第一阶段: 占星基础版 (MVP)**

*状态: 进行中* ▶️

聚焦最小可行：仅依赖生日 (YYYY-MM-DD) 输出基础占星特征，并完成结构化闭环（可解析、可缓存、可度量）。

| 关键成果 (Key Result) | 状态 | 描述 |
| --------------------- | :--: | ---- |
| 核心计算内核          | ✅ | `astrology_kernel` 提供太阳星座计算。 |
| 基础结构化层          | ✅ | Schema V1、Prompt（单条+批量）、解析、容错、fallback、缓存、metrics、批量合并、隐私脱敏完成。 |
| 初始 Schema           | ✅ | 核心字段（sun_sign 等）+ 语义清洗 + 版本号。 |
| LLM 结构化 Prompt     | ✅ | 严格 JSON 约束 + few-shot 支持。 |
| LLM 画像生成 Prompt   | 🚧 | Generation Layer 尚未实现：结构化特征 → 自然语言长描述。 |
| 批量接口实验          | ✅ | `structure_features_batch` 去重 + 合并单 Prompt + 并行回退。 |
| 缓存 & Metrics         | ✅ | LRU+TTL，命中率/调用次数/时延/降级统计，pipeline snapshot。 |
| 隐私 / 脱敏            | ✅ | 默认 `redact_inputs`，日志不暴露原始生日精细信息（后续时间/地点亦同）。 |
| Agent 工具封装        | 🚧 | 计划兼容 OpenAI Function Calling / LangChain Tool 接口。 |
| PyPI 发布              | 🚧 | 打包与首发进行中。 |
| 文档与示例             | ✅ | `README.md` 快速上手示例与清晰目录结构。 |

---

## **第二阶段: 高保真占星引擎**

*状态: 进行中* ▶️

在基础验证后，扩展至完整本命盘：引入出生时间 (HH:MM) 与地点 (lat, lon) → 时区解析 → 行星、宫位、相位、多层特征 Schema 与生成增强。

| 关键成果 (Key Result) | 状态 | 描述 |
| --------------------- | :--: | ---- |
| 支持时间 & 地点       | ✅ | 主类新增 `birth_time`, `location`，统一时区与夏令时转换工具。 |
| 行星星座计算          | ✅ | 太阳以外行星（Moon, Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto）所在星座。 |
| 宫位定位               | ✅ | 计算上升 (Ascendant) 与 12 宫边界，将行星归位至宫。 |
| 核心相位 (Aspects)     | 🚧 | 计划：合/冲/刑/拱/六合（支持容许度配置）。 |
| 扩展 Schema            | 🚧 | 新增 `moon_sign`, `ascendant_sign`, `planet_positions`, `house_positions`, `major_aspects` 等。 |
| Prompt 生成层          | 🚧 | 多级上下文拼接（基础 + advanced）与风格控制 (concise / narrative / coaching)。 |
| 批量成本优化           | 🚧 | Token 估算 & 动态分块阈值 + 缓存预热策略。 |
| 自适应策略             | 🚧 | 失败自动降温、长上下文切片、相位计算退避。 |
| 测试与健壮性           | ✅ | 时区 / DST / 极端纬度（高纬夏季极昼）单元与集成测试。 |
| Web Demo               | 🚧 | 基于 Streamlit/Gradio 的可视化本命盘与画像展示。 |

---

## **第三阶段: 占星画像生态**

*状态: 未来规划* 🚀

聚焦一个纵深：用高保真占星结构化 → 可控风格自然语言画像 → 开发者与用户端应用。暂不扩展多体系，优先做占星领域的“深”与“好”。

| 关键成果 (Key Result) | 状态 | 描述 |
| --------------------- | :--: | ---- |
| 语料与数据集构建      | - | 基于结构化本命盘 + 高质量描述对生成数据集，统一风格层级标签。 |
| 轻量画像模型微调       | - | 微调开放模型（Llama/Mistral 系列）得到占星画像专用小模型，降低成本。 |
| Replay 基准            | - | 固定一组 canonical natal_chart → structured_features → text_outputs 监控漂移。 |
| 生成质量采样管线       | - | 定期采样各类星盘组合并打标签，形成迭代质量闭环。 |
| REST / Serverless 模板 | - | FastAPI + Docker 模板：`POST /chart -> /portrait`。 |
| 前端体验 / Web App     | - | 交互式星盘展示 + 多风格画像切换（concise / deep dive / coaching）。 |
| Agent 集成             | - | 标准函数签名：`get_structured_chart`, `generate_portrait(style=...)`。 |
| 社区与治理             | - | 完善贡献指南、建立讨论区（GitHub Discussions / Discord），开放示例星盘库。 |

---

*图例: ✅ 已完成 | ▶️ 进行中 | 🚧 计划中/即将开始 | - 未来规划*

---

历史多体系（八字、人类图、紫微等）相关代码与文档：
1. 已停止在路线图中规划，不再新增扩展字段。
2. 如保留遗留实现，将标注为 `deprecated` 并在未来一个版本中清理。
3. 若社区对多体系强烈需求，将在占星画像生态阶段后单独评估再纳入。

欢迎就占星领域的新增字段、相位精度、风格控制等在 Issues 中讨论。让我们把一个体系做“深”、做“好”。